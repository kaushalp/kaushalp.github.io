---
id: 297
title: Working with Wild Card Certificates
date: 2013-06-12T13:25:57+00:00
author: kaushal
layout: post
guid: https://blogs.msdn.microsoft.com/kaushal/2013/06/12/working-with-wild-card-certificates/
permalink: /2013/06/12/working-with-wild-card-certificates/
orig_url:
  - http://blogs.msdn.microsoft.com/b/kaushal/archive/2013/06/13/working-with-wild-card-certificates.aspxbr
  - http://blogs.msdn.microsoft.com/b/kaushal/archive/2013/06/13/working-with-wild-card-certificates.aspxbr
  - http://blogs.msdn.microsoft.com/b/kaushal/archive/2013/06/13/working-with-wild-card-certificates.aspxbr
orig_site_id:
  - "13803"
  - "13803"
  - "13803"
orig_post_id:
  - "10425466"
  - "10425466"
  - "10425466"
orig_parent_id:
  - "10425466"
  - "10425466"
  - "10425466"
orig_application_key:
  - kaushal
  - kaushal
  - kaushal
orig_post_author_id:
  - "213737"
  - "213737"
  - "213737"
orig_post_author_username:
  - djkaushal
  - djkaushal
  - djkaushal
orig_post_author_created:
  - 2009-07-24 14:00:49.000
  - 2009-07-24 14:00:49.000
  - 2009-07-24 14:00:49.000
orig_is_approved:
  - "1"
  - "1"
  - "1"
orig_url_title:
  - http://blogs.msdn.com/b/kaushal/archive/2013/06/12/working-with-wild-card-certificates.aspx
  - http://blogs.msdn.com/b/kaushal/archive/2013/06/12/working-with-wild-card-certificates.aspx
  - http://blogs.msdn.com/b/kaushal/archive/2013/06/12/working-with-wild-card-certificates.aspx
orig_post_name:
  - working with wild card certificates
  - working with wild card certificates
  - working with wild card certificates
orig_thread_id:
  - "845923"
  - "845923"
  - "845923"
orig_post_author_email:
  - kaushalp@microsoft.com
  - kaushalp@microsoft.com
  - kaushalp@microsoft.com
orig_attachment_count:
  - "0"
  - "0"
  - "0"
total_views:
  - "11731"
  - "11731"
  - "11731"
opengraph_tags:
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Working with Wild Card Certificates" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/kaushal/2013/06/12/working-with-wild-card-certificates/" />
    <meta property="og:site_name" content="Unleashed" />
    <meta property="og:description" content="Yesterday one of my colleagues came up to me with a simple problem regarding wild card certificates. I gave him the solution immediately, but it had to take a lot of convincing to do. This shows that there is a lot of confusion around how wild card certificates work. For first time readers, wildcard certificates..." />
    <meta property="og:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4278.image_thumb_39613A66.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Working with Wild Card Certificates" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/kaushal/2013/06/12/working-with-wild-card-certificates/" />
    <meta name="twitter:description" content="Yesterday one of my colleagues came up to me with a simple problem regarding wild card certificates. I gave him the solution immediately, but it had to take a lot of convincing to do. This shows that there is a lot of confusion around how wild card certificates work. For first time readers, wildcard certificates..." />
    <meta name="twitter:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4278.image_thumb_39613A66.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Working with Wild Card Certificates" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/kaushal/2013/06/12/working-with-wild-card-certificates/" />
    <meta property="og:site_name" content="Unleashed" />
    <meta property="og:description" content="Yesterday one of my colleagues came up to me with a simple problem regarding wild card certificates. I gave him the solution immediately, but it had to take a lot of convincing to do. This shows that there is a lot of confusion around how wild card certificates work. For first time readers, wildcard certificates..." />
    <meta property="og:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4278.image_thumb_39613A66.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Working with Wild Card Certificates" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/kaushal/2013/06/12/working-with-wild-card-certificates/" />
    <meta name="twitter:description" content="Yesterday one of my colleagues came up to me with a simple problem regarding wild card certificates. I gave him the solution immediately, but it had to take a lot of convincing to do. This shows that there is a lot of confusion around how wild card certificates work. For first time readers, wildcard certificates..." />
    <meta name="twitter:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4278.image_thumb_39613A66.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Working with Wild Card Certificates" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/kaushal/2013/06/12/working-with-wild-card-certificates/" />
    <meta property="og:site_name" content="Unleashed" />
    <meta property="og:description" content="Yesterday one of my colleagues came up to me with a simple problem regarding wild card certificates. I gave him the solution immediately, but it had to take a lot of convincing to do. This shows that there is a lot of confusion around how wild card certificates work. For first time readers, wildcard certificates..." />
    <meta property="og:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4278.image_thumb_39613A66.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Working with Wild Card Certificates" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/kaushal/2013/06/12/working-with-wild-card-certificates/" />
    <meta name="twitter:description" content="Yesterday one of my colleagues came up to me with a simple problem regarding wild card certificates. I gave him the solution immediately, but it had to take a lot of convincing to do. This shows that there is a lot of confusion around how wild card certificates work. For first time readers, wildcard certificates..." />
    <meta name="twitter:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4278.image_thumb_39613A66.png" />
    
categories:
  - Uncategorized
tags:
  - Certificates
  - chrome
  - firefox
  - HTTPS
  - IE
  - IIS 6
  - IIS 7
  - IIS 8
  - internet explorer
  - mozilla
  - opera
  - SAN
  - SAN Certificate
  - SSL
  - ssl_error_bad_cert_domain
  - TLS
  - wildcard certificate
---
<font size="2">Yesterday one of my colleagues came up to me with a simple problem regarding wild card certificates. I gave him the solution immediately, but it had to take a lot of convincing to do. This shows that there is a lot of confusion around how wild card certificates work. </font>

<font size="2">For first time readers, wildcard certificates are server certificates which contain a wildcard (*) as part of the hostname. They offer a great advantage as one hostname containing a wildcard can match multiple hostnames provided they satisfy the condition. </font>

<font size="2">Typically the <strong>Issued To </strong>section of the certificate will contain a hostname with a wildcard. There are real world examples like <strong>Facebook</strong> and <strong>Yahoo</strong>:</font>

<p align="center">
  <a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4403.image_0E1A12AE.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/4403.image_5F00_0E1A12AE.png"><img title="image" style="display: inline; background-image: none;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4278.image_thumb_39613A66.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/4278.image_5F00_thumb_5F00_39613A66.png" width="406" height="531" /></a>&#160;<a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/2161.image_240615AF.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/2161.image_5F00_240615AF.png"><img title="image" style="display: inline; background-image: none;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4101.image_thumb_482E00EF.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/4101.image_5F00_thumb_5F00_482E00EF.png" width="406" height="531" /></a>
</p>

<font size="2"><strong>SAN certificates </strong>can also contain wildcard hostnames. They are a parent set, so a <strong>SAN certificate</strong> is also a wildcard certificate if it contains a hostname with a wildcard as shown in the above image. </font>

<h3 align="center">
  <font style="font-weight: bold;" color="#ff0000" size="4" face="Segoe UI"><u>****CONFUSION****</u></font>
</h3>

<font size="2">As only one cert can be bound to a specific <strong>IP+Port</strong>, regular certificates were not very helpful. </font><font size="2">Wildcard certificates provided solution to this problem. Thought not a full-fledged solution to the problem. It provided some relief. The admins could have a certificate issued to *.contosso.com and then have hostnames configured accordingly.</font>

<font size="2">However this gave rise to some confusion. Even though this is clearly documented in the RFC’s. I have still seen many getting confused on this.</font>

<font size="2">Consider a certificate issued to <strong>*.</strong></font><font size="2"><strong>contosso.com</strong>. </font><font size="2">If this has to be configured any web server, then a question arises. W</font><font size="2">hat all valid hostnames can be configured with the above certificate? </font>

<font size="2">Lets take a look at the below table</font>

<div align="center">
  <table cellspacing="0" cellpadding="2" width="699" align="center" bgcolor="#cccccc" border="1">
    <tr>
      <td valign="top" width="38">
        &nbsp;
      </td>
      
      <td valign="top" width="228">
        <strong><font size="3">SSL Certificate <br />issued to</font></strong>
      </td>
      
      <td valign="top" width="275">
        <font size="3"><strong>Host Name configured on the web server</strong></font>
      </td>
      
      <td valign="top" width="156">
        <font size="3"><strong>Is valid?</strong></font>
      </td>
    </tr>
    
    <tr>
      <td valign="top" width="38">
        <strong><font size="2">1</font></strong>
      </td>
      
      <td valign="top" width="228">
        <font size="2">*.contosso.com</font>
      </td>
      
      <td valign="top" width="275">
        <font size="2">marketing.contosso.com</font>
      </td>
      
      <td valign="top" width="156">
        <b><font color="#00ff00" size="3">✔</font></b>
      </td>
    </tr>
    
    <tr>
      <td valign="top" width="38">
        <font size="2"><strong>2</strong></font>
      </td>
      
      <td valign="top" width="228">
        <font size="2">*.contosso.com</font>
      </td>
      
      <td valign="top" width="275">
        <font size="2">hr.contosso.com</font>
      </td>
      
      <td valign="top" width="156">
        <b><font color="#00ff00" size="3">✔</font></b>
      </td>
    </tr>
    
    <tr>
      <td valign="top" width="38">
        <font size="2"><strong>3</strong></font>
      </td>
      
      <td valign="top" width="228">
        <font size="2">*.contosso.com</font>
      </td>
      
      <td valign="top" width="275">
        <font size="2">apps.developers.contosso.com</font>
      </td>
      
      <td valign="top" width="156">
        <font color="#ff0000" size="3"><strong>❌</strong></font>
      </td>
    </tr>
    
    <tr>
      <td valign="top" width="38">
        <font size="2"><strong>4</strong></font>
      </td>
      
      <td valign="top" width="232">
        <font size="2">*.contosso.com</font>
      </td>
      
      <td valign="top" width="319">
        <font size="2">123.test.beta.contosso.com</font>
      </td>
      
      <td valign="top" width="199">
        <font color="#ff0000" size="3"><strong>❌</strong></font>
      </td>
    </tr>
  </table>
</div>

<font size="2">Looking at the above table you should have understood that the wildcard character allows only one single domain as an addition to the hostname.</font>

<font size="2">If you were to configure a host name as per 3 & 4 on IIS for a cert issued to *.</font><font size="2">contosso.com</font><font size="2">, then the client browser would throw an error indicating address mismatch. Different browsers throw different errors.</font>

<font size="2">Below is a snapshot of errors thrown by different browsers:</font>

  * **<font size="4">Internet Explorer:</font>**

<font size="2"><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/3073.image_208A1576.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/3073.image_5F00_208A1576.png"><img title="image" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/3414.image_thumb_16C4ADFE.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/3414.image_5F00_thumb_5F00_16C4ADFE.png" width="749" height="319" /></a></font>

<font size="2">IE displays a user friendly error. It doesn’t contain any detailed errors, which is not required but nevertheless they cant be completely ignored. A little more detail in this regards would have been better.</font>

  * <font size="4"><strong>Google Chrome:</strong></font>

<a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/6683.image_3AEC993E.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/6683.image_5F00_3AEC993E.png"><img title="image" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/7140.image_thumb_3A82F6FA.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/7140.image_5F00_thumb_5F00_3A82F6FA.png" width="746" height="382" /></a>

<font size="2">Chrome does a better job than IE here, it provides more details informing the user what the certificate is issued to and the hostname they are browsing to.</font>

  * ### <font size="4"><font style="font-weight: bold;" face="Segoe UI">Mozilla Firefox:</font></font>

### <a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/4375.image_6BA4C24B.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/4375.image_5F00_6BA4C24B.png"><img title="image" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/5707.image_thumb_24BE2FFF.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/5707.image_5F00_thumb_5F00_24BE2FFF.png" width="647" height="412" /></a>

<font size="2">Mozilla Firefox gives more detailed error on what actually happened. It includes the <strong>Error code ssl_error_bad_cert_domain</strong>.</font>

  * ### **<font size="4" face="Segoe UI">Opera</font>**

### <a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/6646.image_0F630B48.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/6646.image_5F00_0F630B48.png"><img title="image" style="margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1464.image_thumb_581C840C.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/1464.image_5F00_thumb_5F00_581C840C.png" width="453" height="464" /></a>

<font size="2"></font> 

<font size="2"></font>

<font size="2">Opera gives details about the certificate, but the information is not presented as clearly as <strong>Firefox</strong> or <strong>Chrome</strong> for that matter.</font>

<p align="center">
  <font color="#09a5e8" size="5"><u><strong>****REASON****</strong></u></font>
</p>

<font size="2">Now why is that the last 2 (3 & 4) in the table were invalid? The reason is that the <strong><u>RFC2818</u></strong> defines it to be this way. <font style="background-color: rgb(255, 255, 0);">The <strong>RFC</strong> allows matching of only a single domain for a given wild card character</font>.</font>

<font size="2">Below is a snippet of </font>[<font size="2">RFC 2818</font>](http://tools.ietf.org/html/rfc2818)<font size="2">:</font>

<table cellspacing="0" cellpadding="2" width="679" align="center" bgcolor="#bbbbbb" border="1">
  <tr>
    <td valign="top" width="677">
      <pre><pre><font size="2"><strong>Rescorla                     Informational                      [Page 4]
</strong></font></pre>


<pre><a name="page-5" href="http://tools.ietf.org/html/rfc2818#page-5"><font size="2"><strong> </strong></font></a><font size="2"><strong>
</strong></font><a href="http://tools.ietf.org/html/rfc2818"><font size="2"><strong>RFC 2818</strong></font></a><font size="2"><strong>                     HTTP Over TLS                      May 2000</strong></font>
</pre>


<h4>
  <a name="section-3" href="http://tools.ietf.org/html/rfc2818#section-3">3</a>.  Endpoint Identification
</h4>


<h5>
  <a name="section-3.1" href="http://tools.ietf.org/html/rfc2818#section-3.1">3.1</a>.  Server Identity
</h5>


<p>
  In general, HTTP/TLS requests are generated by dereferencing a URI.<br />
     As a consequence, the hostname for the server is known to the client.<br />
     If the hostname is available, the client MUST check it against the<br />
     server's identity as presented in the server's Certificate message,<br />
     in order to prevent man-in-the-middle attacks.
</p>


<p>
  If the client has external information as to the expected identity of<br />
     the server, the hostname check MAY be omitted. (For instance, a<br />
     client may be connecting to a machine whose address and hostname are<br />
     dynamic but the client knows the certificate that the server will<br />
     present.) In such cases, it is important to narrow the scope of<br />
     acceptable certificates as much as possible in order to prevent man
</p>


<pre>   in the middle attacks.  In special cases, it may be appropriate for
   the client to simply ignore the server's identity, but it must be
   understood that this leaves the connection open to active attack.

   If a subjectAltName extension of type dNSName is present, that MUST
   be used as the identity. Otherwise, the (most specific) Common Name
   field in the Subject field of the certificate MUST be used. Although
   the use of the Common Name is existing practice, it is deprecated and
   Certification Authorities are encouraged to use the dNSName instead.

   <font style="background-color: rgb(255, 255, 0);">Matching is performed using the matching rules specified by
</font>   <font style="background-color: rgb(255, 255, 0);">[</font><a href="http://tools.ietf.org/html/rfc2459"><font style="background-color: rgb(255, 255, 0);">RFC2459</font></a><font style="background-color: rgb(255, 255, 0);">].  If more than one identity of a given type is present in
</font>   <font style="background-color: rgb(255, 255, 0);">the certificate (e.g., more than one dNSName name, a match in any one
</font>   <font style="background-color: rgb(255, 255, 0);">of the set is considered acceptable.) Names may contain the wildcard
</font>   <font style="background-color: rgb(255, 255, 0);">character * which is considered to match any single domain name
</font>   <font style="background-color: rgb(255, 255, 0);">component or component fragment. <strong><font color="#0000ff">E.g., *.a.com matches foo.a.com but
</font></strong></font><strong><font color="#0000ff">   <font style="background-color: rgb(255, 255, 0);">not bar.foo.a.com. f*.com matches foo.com but not bar.com.</font></font></strong>

   <font color="#9b00d3"><strong><font color="#0000ff">In some cases, the URI is specified as an IP address rather than a
   hostname. In this case, the iPAddress subjectAltName must be present
   in the certificate and must exactly match the IP in the URI.</font></strong>
</font>
   If the hostname does not match the identity in the certificate, user
   oriented clients MUST either notify the user (clients MAY give the
   user the opportunity to continue with the connection in any case) or
   terminate the connection with a bad certificate error. Automated
   clients MUST log the error to an appropriate audit log (if available)
   and SHOULD terminate the connection (with a bad certificate error).
   Automated clients MAY provide a configuration setting that disables
   this check, but MUST provide a setting which enables it.

   Note that in many cases the URI itself comes from an untrusted
   source. The above-described check provides no protection against
   attacks where this source is compromised. For example, if the URI was
   obtained by clicking on an HTML page which was itself obtained
   without using HTTP/TLS, a man in the middle could have replaced the
   URI.  In order to prevent this form of attack, users should carefully
   examine the certificate presented by the server to determine if it
   meets their expectations.
        </pre>
</td>
</tr>
</tbody>
</table>


<p>
  <font size="2">If you observe the above snippet carefully you would notice that certificates can be issued to IPAddresses as well. But then the IPAddress should match the IPAddress in the certificate exactly. failing which could lead to a address mismatch error.</font>
</p>


<p>
  <font size="2">Hope this clears some confusion. Let me know if this post helped you.</font>
</p>
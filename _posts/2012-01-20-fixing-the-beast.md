---
id: 45
title: Fixing the BEAST
date: 2012-01-20T15:47:56+00:00
author: kaushal
layout: post
guid: https://blogs.msdn.microsoft.com/kaushal/2012/01/20/fixing-the-beast/
permalink: /2012/01/20/fixing-the-beast/
orig_url:
  - http://blogs.msdn.microsoft.com/b/kaushal/archive/2022/02/22/fixing-the-beast.aspx
  - http://blogs.msdn.microsoft.com/b/kaushal/archive/2022/02/22/fixing-the-beast.aspx
  - http://blogs.msdn.microsoft.com/b/kaushal/archive/2022/02/22/fixing-the-beast.aspx
orig_site_id:
  - "13803"
  - "13803"
  - "13803"
orig_post_id:
  - "10259070"
  - "10259070"
  - "10259070"
orig_parent_id:
  - "10259070"
  - "10259070"
  - "10259070"
orig_application_key:
  - kaushal
  - kaushal
  - kaushal
orig_post_author_id:
  - "213737"
  - "213737"
  - "213737"
orig_post_author_username:
  - djkaushal
  - djkaushal
  - djkaushal
orig_post_author_created:
  - 2009-07-24 14:00:49.000
  - 2009-07-24 14:00:49.000
  - 2009-07-24 14:00:49.000
orig_is_approved:
  - "1"
  - "1"
  - "1"
orig_url_title:
  - http://blogs.msdn.com/b/kaushal/archive/2012/01/20/fixing-the-beast.aspx
  - http://blogs.msdn.com/b/kaushal/archive/2012/01/20/fixing-the-beast.aspx
  - http://blogs.msdn.com/b/kaushal/archive/2012/01/20/fixing-the-beast.aspx
orig_post_name:
  - fixing the beast
  - fixing the beast
  - fixing the beast
orig_thread_id:
  - "794520"
  - "794520"
  - "794520"
orig_post_author_email:
  - kaushalp@microsoft.com
  - kaushalp@microsoft.com
  - kaushalp@microsoft.com
orig_attachment_count:
  - "0"
  - "0"
  - "0"
total_views:
  - "69228"
  - "69228"
  - "69228"
opengraph_tags:
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Fixing the BEAST" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/kaushal/2012/01/20/fixing-the-beast/" />
    <meta property="og:site_name" content="Unleashed" />
    <meta property="og:description" content="Earlier I had posted a blog explaining the BEAST vulnerability observed in TLS 1.0 &amp; SSL 3.0. Here is the blog link: http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx Microsoft released MS12-006 patch last week to address BEAST. As usual, after this update, we were bombarded with cases. After applying this update, supposedly many applications were in a broken state (mostly..." />
    <meta property="og:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Fixing the BEAST" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/kaushal/2012/01/20/fixing-the-beast/" />
    <meta name="twitter:description" content="Earlier I had posted a blog explaining the BEAST vulnerability observed in TLS 1.0 &amp; SSL 3.0. Here is the blog link: http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx Microsoft released MS12-006 patch last week to address BEAST. As usual, after this update, we were bombarded with cases. After applying this update, supposedly many applications were in a broken state (mostly..." />
    <meta name="twitter:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Fixing the BEAST" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/kaushal/2012/01/20/fixing-the-beast/" />
    <meta property="og:site_name" content="Unleashed" />
    <meta property="og:description" content="Earlier I had posted a blog explaining the BEAST vulnerability observed in TLS 1.0 &amp; SSL 3.0. Here is the blog link: http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx Microsoft released MS12-006 patch last week to address BEAST. As usual, after this update, we were bombarded with cases. After applying this update, supposedly many applications were in a broken state (mostly..." />
    <meta property="og:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Fixing the BEAST" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/kaushal/2012/01/20/fixing-the-beast/" />
    <meta name="twitter:description" content="Earlier I had posted a blog explaining the BEAST vulnerability observed in TLS 1.0 &amp; SSL 3.0. Here is the blog link: http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx Microsoft released MS12-006 patch last week to address BEAST. As usual, after this update, we were bombarded with cases. After applying this update, supposedly many applications were in a broken state (mostly..." />
    <meta name="twitter:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" />
    
  - |
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Fixing the BEAST" />
    <meta property="og:url" content="https://blogs.msdn.microsoft.com/kaushal/2012/01/20/fixing-the-beast/" />
    <meta property="og:site_name" content="Unleashed" />
    <meta property="og:description" content="Earlier I had posted a blog explaining the BEAST vulnerability observed in TLS 1.0 &amp; SSL 3.0. Here is the blog link: http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx Microsoft released MS12-006 patch last week to address BEAST. As usual, after this update, we were bombarded with cases. After applying this update, supposedly many applications were in a broken state (mostly..." />
    <meta property="og:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Fixing the BEAST" />
    <meta name="twitter:url" content="https://blogs.msdn.microsoft.com/kaushal/2012/01/20/fixing-the-beast/" />
    <meta name="twitter:description" content="Earlier I had posted a blog explaining the BEAST vulnerability observed in TLS 1.0 &amp; SSL 3.0. Here is the blog link: http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx Microsoft released MS12-006 patch last week to address BEAST. As usual, after this update, we were bombarded with cases. After applying this update, supposedly many applications were in a broken state (mostly..." />
    <meta name="twitter:image" content="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" />
    
categories:
  - Uncategorized
---
<font face="Century Schoolbook">Earlier I had posted a blog explaining the BEAST vulnerability observed in TLS 1.0 & SSL 3.0. Here is the blog link: </font>[<font color="#0000ff" face="Century Schoolbook"><u>http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx</u></font>](http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx "http://blogs.msdn.com/b/kaushal/archive/2011/10/03/taming-the-beast-browser-exploit-against-ssl-tls.aspx")

<font face="Century Schoolbook">Microsoft released <strong><a href="http://technet.microsoft.com/en-us/security/bulletin/ms12-006#section1" target="_blank" rel="noopener noreferrer"><font color="#0000ff"><u>MS12-006</u></font></a></strong> patch last week to address BEAST. As usual, after this update<img class="wlEmoticon wlEmoticon-smile" alt="Smile" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/1738.wlEmoticon_2D00_smile_5F00_3634A682.png" />, we were bombarded with cases.</font>

<font face="Century Schoolbook">After applying this update, supposedly many applications were in a broken state (<strong><font color="#ff0000">mostly </font><font color="#ff0000">3rd party</font></strong>). Everyone was blaming MS (as usual) for the problem. I don’t think most of them understood what this patch was all about. Reading further you would realize what broke the applications.</font>

<font face="Century Schoolbook">The security patch implemented a solution which was present in the RFC documentation and is as per the <a href="http://www.ietf.org/rfc/rfc2246.txt" target="_blank" rel="noopener noreferrer"><font color="#0000ff"><u>RFC 2246</u></font></a>. Below is a snippet from the rfc:</font>

<table cellspacing="0" cellpadding="2" width="550" border="2" frame="border">
  <tr>
    <td style="background: rgb(110, 106, 107); height: 15pt; padding-top: 0in; padding-right: 5.4pt;" valign="top" width="614">
      <p align="justify">
        <font size="2" face="Consolas"><strong>6.2.1. Fragmentation</strong> </p> 
        
        <p>
          The record layer fragments information blocks into TLSPlaintext records carrying data in chunks of 2^14 bytes or less. Client message boundaries are not preserved in the record layer (i.e., multiple client messages of the same ContentType may be coalesced into a single TLSPlaintext record, or a single message may be fragmented across several records).
        </p>
        
        <p>
          struct { <br />uint8 major, minor; <br />} ProtocolVersion; </font>
        </p>
        
        <p align="left">
          <font size="2" face="Consolas">Dierks & Allen&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Standards Track&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; [Page 16]</font>
        </p>
        
        <p>
          <font size="2" face="Consolas"> </p> 
          
          <p align="justify">
            RFC 2246&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; The TLS Protocol Version 1.0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; January 1999
          </p>
          
          <p align="justify">
            enum { <br />change_cipher_spec(20), alert(21), handshake(22), application_data(23), (255) <br />} ContentType;
          </p>
          
          <p>
            struct { <br />ContentType type; <br />ProtocolVersion version; <br />uint16 length; <br />opaque fragment[TLSPlaintext.length]; <br />} TLSPlaintext;
          </p>
          
          <p>
            </font></td> </tr> </tbody> </table> 
            
            <p>
              &#160;
            </p>
            
            <p>
              <font face="Century Schoolbook">Now, I need not explain what the <strong>BEAST</strong> vulnerability is all about. You can refer my blog for this.</font>
            </p>
            
            <p align="center">
              <strong><u><font size="4" face="Century Schoolbook">MS12-006 FIX for BEAST</font></u></strong>
            </p>
            
            <ol>
              <li>
                <font face="Century Schoolbook">The security patch mainly addresses the vulnerability in protocols TLS 1.0 & SSL 3.0. <br /></font>
              </li>
              <li>
                <font face="Century Schoolbook">The <strong>BEAST</strong> vulnerability is addressed by splitting (or fragmenting) the application data in to SSL records in the fashion 1/(n-1). This is explained in RFC2246 (<strong>section 6.2.1 Fragmentation</strong>). </font>
              </li>
            </ol>
            
            <p>
              <font face="Century Schoolbook"><font style="background-color: rgb(204, 204, 204);" color="#0000a0">This is where the problem arises, most of the applications haven’t implemented the RFC correctly. They assume that the application data will be packed into a single packet. Whenever the data is split into records, they don’t understand the response and leads to incompatibility between them.</font> </font>
            </p>
            
            <p>
              <font face="Century Schoolbook"> <br />Please refer this link for supported protocols on Windows OS: <a title="http://blogs.msdn.com/b/kaushal/archive/2011/10/02/support-for-ssl-tls-protocols-on-windows.aspx" href="http://blogs.msdn.com/b/kaushal/archive/2011/10/02/support-for-ssl-tls-protocols-on-windows.aspx"><u><font color="#0000ff">http://blogs.msdn.com/b/kaushal/archive/2011/10/02/support-for-ssl-tls-protocols-on-windows.aspx</font></u></a></font>
            </p>
            
            <p align="center">
              <font size="4" face="Century Schoolbook"><strong><u> <br />Addressing the compatibility issues</u></strong></font>
            </p>
            
            <p>
              <font face="Century Schoolbook"><a href="http://support.microsoft.com/kb/2643584" target="_blank" rel="noopener noreferrer"><strong><font color="#0000ff"><u>KB2643584</u></font></strong></a> was introduced to address the compatibility issues caused by the <strong><a href="http://technet.microsoft.com/en-us/security/bulletin/ms12-006#section1" target="_blank" rel="noopener noreferrer"><u><font color="#0000ff">MS12-006</font></u></a></strong> security patch.</font>
            </p>
            
            <ol>
              <li>
                <font face="Century Schoolbook">It contains fixit links to enable TLS 1.1 protocol for IE (Client) and Windows based Servers. <br /><font style="background-color: rgb(255, 255, 0);" size="2"><strong>NOTE: This is applicable to Windows 7 and Windows Server 2008 R2 only.</strong></font></font><font style="background-color: rgb(255, 255, 0);" size="2"><strong> 
                
                <p>
                  </strong></font></li> 
                  
                  <li>
                    <font face="Century Schoolbook">Disable the fragmentation/splitting of records which causes the in-compatibility. This is done via a editing the registry. Below are the steps to change the registry: <br /></font> <ul>
                      <li>
                        Click <strong>Start</strong>, click <strong>Run</strong>, type regedit in the <strong>Open</strong> box, and then click <strong>OK</strong>.
                      </li>
                      <li>
                        Locate and then click the following subkey in the registry: <p>
                          <strong>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurityProviders\SCHANNEL</strong>
                        </p>
                      </li>
                      
                      <li>
                        On the <strong>Edit</strong> menu, point to <strong>New</strong>, and then click <strong>DWORD Value</strong>.
                      </li>
                      <li>
                        Type SendExtraRecord for the name of the DWORD, and then press ENTER.
                      </li>
                      <li>
                        Right-click <b>SendExtraRecord</b>, and then click <strong>Modify</strong>.
                      </li>
                      <li>
                        In the <strong>Value data</strong> box, type 2 to disable the split record in schannel, and then click <strong>OK</strong>.
                      </li>
                      <li>
                        Exit Registry Editor.
                      </li>
                    </ul>
                  </li></ol> 
                  
                  <p>
                    <font face="Century Schoolbook"> </p> 
                    
                    <p>
                      <font style="background-color: rgb(255, 255, 0);"><font size="2"><strong>NOTE: </strong>The above registry key disables the patch applied on the server and the server is exposed to the vulnerability again. In this case you will have to disable all CBC based ciphers and prioritize RC4 based&#160; ciphers<font style="background-color: rgb(255, 255, 0);">.</font></font></font><font style="background-color: rgb(255, 255, 0);" size="2"> </font>
                    </p>
                    
                    <p>
                      Splitting of records is the only real solution available for the following OS’s as they don’t support TLS 1.1 & TLS 1.2:
                    </p>
                    
                    <ul>
                      <li>
                        Windows XP
                      </li>
                      <li>
                        Windows Vista
                      </li>
                      <li>
                        Windows Server 2003
                      </li>
                      <li>
                        Windows Server 2008
                      </li>
                    </ul>
                    
                    <p>
                      On Vista and Windows Server 2008, one can prioritize the RC4 based ciphers over CBC based ciphers. This cannot be done in XP or 2003 though.
                    </p>
                    
                    <p>
                      Till then Ciao! <img class="wlEmoticon wlEmoticon-smile" alt="Smile" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/38/03/metablogapi/1738.wlEmoticon-smile_3634A682.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-38-03-metablogapi/1738.wlEmoticon_2D00_smile_5F00_3634A682.png" />
                    </p>
                    
                    <p>
                      </font>
                    </p>